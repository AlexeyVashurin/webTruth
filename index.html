<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Telegram TWA SDK Test</title>
</head>
<body>
<h1>Telegram TWA SDK Test</h1>
<button id="triggerBuy">Trigger Buy</button>

<!-- Используем type="module" для работы с импортами -->
<script type="module">
    // Импортируем объект WebApp из пакета
    import { WebApp } from '@twa-dev/sdk';

    // Инициализируем SDK
    WebApp.ready();
    WebApp.showAlert("SDK loaded and ready!");

    // Обработчик клика по кнопке
    document.getElementById("triggerBuy").addEventListener("click", async () => {
        console.log("Trigger Buy clicked");
        try {
            // Запрос к серверу для получения ссылки инвойса
            const response = await fetch('https://sucisique.beget.app/generate-invoice', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ /* добавьте необходимые данные */ })
            });

            if (!response.ok) {
                throw new Error("Failed to get invoice link");
            }

            const data = await response.json();
            const invoiceLink = data.invoiceLink;
            console.log("Invoice link received:", invoiceLink);

            // Проверяем наличие метода openInvoice
            if (typeof WebApp.openInvoice === "function") {
                WebApp.openInvoice(invoiceLink, (status) => {
                    console.log("Payment status:", status);
                    if (status === "paid") {
                        WebApp.showAlert("Payment successful!");
                    } else {
                        WebApp.showAlert("Payment not completed. Status: " + status);
                    }
                });
            } else {
                console.error("openInvoice method is not available in this version of the TWA SDK.");
                WebApp.showAlert("Your Telegram client does not support openInvoice.");
            }
        } catch (error) {
            console.error("Error during triggerBuy:", error);
            WebApp.showAlert("An error occurred: " + error.message);
        }
    });
</script>
</body>
</html>
